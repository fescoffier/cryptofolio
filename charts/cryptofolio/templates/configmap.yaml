apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "cryptofolio-collector-job.fullname" . }}-config
  labels:
    {{- include "cryptofolio-collector-job.labels" . | nindent 4 }}
data:
  appsettings.{{ .Values.jobs.collector.environment }}.json: |
    {
      "Serilog": {
        "MinimumLevel": {
          "Default": "{{ .Values.jobs.collector.config.logLevel }}"
        },
        "Elasticsearch": {{ .Values.jobs.collector.config.elasticsearch | toJson }}
      },
      "ConnectionStrings": {
        "Redis": "{{ .Values.jobs.collector.config.connectionStrings.redis }}"
      },
      "Kafka": {
        "Producer": {{ .Values.jobs.collector.config.kafka.producerConfig | toJson }},
        "Consumer": {{ .Values.jobs.collector.config.kafka.consumerConfig | toJson }}
      },
      "Elasticsearch": {{ .Values.jobs.collector.config.elasticsearch | toJson }},
      "Data": {
        "CronCheckIntervalMs": {{ .Values.jobs.collector.config.data.cronCheckIntervalMs }},
        "InvalidCronCheckIntervalMs": {{ .Values.jobs.collector.config.data.invalidCronCheckIntervalMs }},
        "Schedules": {
          "Cryptofolio.Infrastructure.Data.AssetDataRequest": "{{ .Values.jobs.collector.config.data.schedules.assetDataRequest }}",
          "Cryptofolio.Infrastructure.Data.AssetTickerDataRequest": "{{ .Values.jobs.collector.config.data.schedules.assetTickerDataRequest }}",
          "Cryptofolio.Infrastructure.Data.ExchangeDataRequest": "{{ .Values.jobs.collector.config.data.schedules.exchangeDataRequest }}"
        }
      },
      "Coingecko": {
        "ApiUri": "{{ .Values.jobs.collector.config.coingecko.apiUri }}",
        "RateLimiterKey": "{{ .Values.jobs.collector.config.coingecko.rateLimiterKey }}",
        "RateLimiterKeyExiprationSeconds": {{ .Values.jobs.collector.config.coingecko.rateLimiterKeyExiprationSeconds }},
        "RateLimiterMaxValue": {{ .Values.jobs.collector.config.coingecko.rateLimiterMaxValue }},
        "RateLimiterCheckIntervalMs": {{ .Values.jobs.collector.config.coingecko.rateLimiterCheckIntervalMs }}
      }
    }

---

apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "cryptofolio-handlers-job.fullname" . }}-config
  labels:
    {{- include "cryptofolio-handlers-job.labels" . | nindent 4 }}
data:
  appsettings.{{ .Values.jobs.handlers.environment }}.json: |
    {
      "Serilog": {
        "MinimumLevel": {
          "Default": "{{ .Values.jobs.handlers.config.logLevel }}"
        },
        "Elasticsearch": {{ .Values.jobs.handlers.config.elasticsearch | toJson }}
      },
      "ConnectionStrings": {
        "Redis": "{{ .Values.jobs.handlers.config.connectionStrings.redis }}"
      },
      "Kafka": {
        "Producer": {{ .Values.jobs.handlers.config.kafka.producerConfig | toJson }},
        "Consumer": {{ .Values.jobs.handlers.config.kafka.consumerConfig | toJson }}
      },
      "Elasticsearch": {{ .Values.jobs.handlers.config.elasticsearch | toJson }}
    }